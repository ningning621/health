<html>

<title>Read CSV</title>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="http://d3js.org/topojson.v2.min.js"></script>

<script>

var readData = d3.csv("RegionalInterestByConditionOverTime.csv", function(d) {
	return {
		city: d.dma,
		state: d.dma.substr(d.dma.length - 2),
		geoCode: +d.geoCode,
		_2004_cancer: +d["2004+cancer"],
		_2004_cardiovascular: +d["2004+cardiovascular"],
		_2004_stroke: +d["2004+stroke"],
		_2004_depression: +d["2004+depression"],
		_2004_rehab: +d["2004+rehab"],
		_2004_vaccine: +d["2004+vaccine"],
		_2004_diarrhea: +d["2004+diarrhea"],
		_2004_obesity: +d["2004+obesity"],
		_2004_diabetes: +d["2004+diabetes"],
		_2005_cancer: +d["2005+cancer"],
		_2005_cardiovascular: +d["2005+cardiovascular"],
		_2005_stroke: +d["2005+stroke"],
		_2005_depression: +d["2005+depression"],
		_2005_rehab: +d["2005+rehab"],
		_2005_vaccine: +d["2005+vaccine"],
		_2005_diarrhea: +d["2005+diarrhea"],
		_2005_obesity: +d["2005+obesity"],
		_2005_diabetes: +d["2005+diabetes"],
		_2006_cancer: +d["2006+cancer"],
		_2006_cardiovascular: +d["2006+cardiovascular"],
		_2006_stroke: +d["2006+stroke"],
		_2006_depression: +d["2006+depression"],
		_2006_rehab: +d["2006+rehab"],
		_2006_vaccine: +d["2006+vaccine"],
		_2006_diarrhea: +d["2006+diarrhea"],
		_2006_obesity: +d["2006+obesity"],
		_2006_diabetes: +d["2006+diabetes"],
		_2007_cancer: +d["2007+cancer"],
		_2007_cardiovascular: +d["2007+cardiovascular"],
		_2007_stroke: +d["2007+stroke"],
		_2007_depression: +d["2007+depression"],
		_2007_rehab: +d["2007+rehab"],
		_2007_vaccine: +d["2007+vaccine"],
		_2007_diarrhea: +d["2007+diarrhea"],
		_2007_obesity: +d["2007+obesity"],
		_2007_diabetes: +d["2007+diabetes"],
		_2008_cancer: +d["2008+cancer"],
		_2008_cardiovascular: +d["2008+cardiovascular"],
		_2008_stroke: +d["2008+stroke"],
		_2008_depression: +d["2008+depression"],
		_2008_rehab: +d["2008+rehab"],
		_2008_vaccine: +d["2008+vaccine"],
		_2008_diarrhea: +d["2008+diarrhea"],
		_2008_obesity: +d["2008+obesity"],
		_2008_diabetes: +d["2008+diabetes"],
		_2009_cancer: +d["2009+cancer"],
		_2009_cardiovascular: +d["2009+cardiovascular"],
		_2009_stroke: +d["2009+stroke"],
		_2009_depression: +d["2009+depression"],
		_2009_rehab: +d["2009+rehab"],
		_2009_vaccine: +d["2009+vaccine"],
		_2009_diarrhea: +d["2009+diarrhea"],
		_2009_obesity: +d["2009+obesity"],
		_2009_diabetes: +d["2009+diabetes"],
		_2010_cancer: +d["2010+cancer"],
		_2010_cardiovascular: +d["2010+cardiovascular"],
		_2010_stroke: +d["2010+stroke"],
		_2010_depression: +d["2010+depression"],
		_2010_rehab: +d["2010+rehab"],
		_2010_vaccine: +d["2010+vaccine"],
		_2010_diarrhea: +d["2010+diarrhea"],
		_2010_obesity: +d["2010+obesity"],
		_2010_diabetes: +d["2010+diabetes"],
		_2011_cancer: +d["2011+cancer"],
		_2011_cardiovascular: +d["2011+cardiovascular"],
		_2011_stroke: +d["2011+stroke"],
		_2011_depression: +d["2011+depression"],
		_2011_rehab: +d["2011+rehab"],
		_2011_vaccine: +d["2011+vaccine"],
		_2011_diarrhea: +d["2011+diarrhea"],
		_2011_obesity: +d["2011+obesity"],
		_2011_diabetes: +d["2011+diabetes"],
		_2012_cancer: +d["2012+cancer"],
		_2012_cardiovascular: +d["2012+cardiovascular"],
		_2012_stroke: +d["2012+stroke"],
		_2012_depression: +d["2012+depression"],
		_2012_rehab: +d["2012+rehab"],
		_2012_vaccine: +d["2012+vaccine"],
		_2012_diarrhea: +d["2012+diarrhea"],
		_2012_obesity: +d["2012+obesity"],
		_2012_diabetes: +d["2012+diabetes"],
		_2013_cancer: +d["2013+cancer"],
		_2013_cardiovascular: +d["2013+cardiovascular"],
		_2013_stroke: +d["2013+stroke"],
		_2013_depression: +d["2013+depression"],
		_2013_rehab: +d["2013+rehab"],
		_2013_vaccine: +d["2013+vaccine"],
		_2013_diarrhea: +d["2013+diarrhea"],
		_2013_obesity: +d["2013+obesity"],
		_2013_diabetes: +d["2013+diabetes"],
		_2014_cancer: +d["2014+cancer"],
		_2014_cardiovascular: +d["2014+cardiovascular"],
		_2014_stroke: +d["2014+stroke"],
		_2014_depression: +d["2014+depression"],
		_2014_rehab: +d["2014+rehab"],
		_2014_vaccine: +d["2014+vaccine"],
		_2014_diarrhea: +d["2014+diarrhea"],
		_2014_obesity: +d["2014+obesity"],
		_2014_diabetes: +d["2014+diabetes"],
		_2015_cancer: +d["2015+cancer"],
		_2015_cardiovascular: +d["2015+cardiovascular"],
		_2015_stroke: +d["2015+stroke"],
		_2015_depression: +d["2015+depression"],
		_2015_rehab: +d["2015+rehab"],
		_2015_vaccine: +d["2015+vaccine"],
		_2015_diarrhea: +d["2015+diarrhea"],
		_2015_obesity: +d["2015+obesity"],
		_2015_diabetes: +d["2015+diabetes"],
		_2016_cancer: +d["2016+cancer"],
		_2016_cardiovascular: +d["2016+cardiovascular"],
		_2016_stroke: +d["2016+stroke"],
		_2016_depression: +d["2016+depression"],
		_2016_rehab: +d["2016+rehab"],
		_2016_vaccine: +d["2016+vaccine"],
		_2016_diarrhea: +d["2016+diarrhea"],
		_2016_obesity: +d["2016+obesity"],
		_2016_diabetes: +d["2016+diabetes"],
		_2017_cancer: +d["2017+cancer"],
		_2017_cardiovascular: +d["2017+cardiovascular"],
		_2017_stroke: +d["2017+stroke"],
		_2017_depression: +d["2017+depression"],
		_2017_rehab: +d["2017+rehab"],
		_2017_vaccine: +d["2017+vaccine"],
		_2017_diarrhea: +d["2017+diarrhea"],
		_2017_obesity: +d["2017+obesity"],
		_2017_diabetes: +d["2017+diabetes"]
	};
}, function(data) {
	genGraphs(data);
});

diseases = ["cancer", "cardiovascular", "stroke", "depression", "rehab", "vaccine", "diarrhea", "obesity", "diabetes"];
years = [2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]

function genGraphs (data) {
	//console.log(data);
	lineGraphDict = lineGraphData(data);
	mapGraphDict = mapGraphData(data);
}

function addToDict (dict, disease, count, year) {
	tmp = dict[year];
	if (disease in dict[year]) {
		tmp[disease] += count;
	}
	else {
		tmp[disease] = count;
	}
	dict[year] = tmp;
	return dict;

} 
function lineGraphData(data) {
	var dict = { }; // {year, {disease, count}}
	data.forEach(function(element) {
	   for(year in years) {
	  	for (disease in diseases)  {
	  		if (years[year] in dict) {
	  			dict = addToDict(dict, diseases[disease], element["_"+years[year]+"_"+diseases[disease]], years[year]);
	  		}
	  		else {
	  			var x = {};
	  			x[diseases[disease]] = element["_"+years[year]+"_"+diseases[disease]];
	  			dict[years[year]] = x;
	  		}
	  		
	  	}
	  }
	});
	return dict;
}

function getMax(dict) {
	var result = {};
	for (key in dict) {
		var max;
		obj = dict[key];
		max = Object.keys(obj).reduce((a, b) => obj[a] > obj[b] ? a : b);
		result[key] = max;
	}
	return result;
}

function mapGraphData(data){
	var dict = { }; // {state, {disease, count}}
	var arr = []
	data.forEach(function(element) {
	   for(year in years) {
	  	for (disease in diseases)  {
	  		if (element.state in dict) {
	  			dict = addToDict(dict, diseases[disease], element["_"+years[year]+"_"+diseases[disease]], element.state);
	  		}
	  		else {
	  			var x = {};
	  			x[diseases[disease]] = element["_"+years[year]+"_"+diseases[disease]];
	  			dict[element.state] = x;
	  		}
	  	}
	  }
	});
	result = getMax(dict);
	return result;
}
</script>

</html>

